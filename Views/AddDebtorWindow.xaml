<!-- Views/AddDebtorWindow.xaml -->
<Window x:Class="bankrupt_piterjust.Views.AddDebtorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:bankrupt_piterjust.ViewModels"
        mc:Ignorable="d"
        Title="Добавить нового должника" Height="700" Width="800"
        WindowStartupLocation="CenterOwner" ResizeMode="CanResize"
        Background="#F8F9FA">
    
    <Window.DataContext>
        <vm:AddDebtorViewModel/>
    </Window.DataContext>
    
    <Window.Resources>
        <!-- Styles -->
        <Style x:Key="HeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,10,0,5"/>
        </Style>
        
        <Style x:Key="FormTextBlock" TargetType="TextBlock">
            <Setter Property="Margin" Value="0,5,0,2"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <Style x:Key="FormTextBox" TargetType="TextBox">
            <Setter Property="Margin" Value="0,2,0,5"/>
            <Setter Property="Padding" Value="5,3"/>
            <Setter Property="Height" Value="30"/>
        </Style>
        
        <Style x:Key="FormDatePicker" TargetType="DatePicker">
            <Setter Property="Margin" Value="0,2,0,5"/>
            <Setter Property="Height" Value="30"/>
        </Style>
        
        <Style x:Key="FormCheckBox" TargetType="CheckBox">
            <Setter Property="Margin" Value="0,5,0,5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="TabButton" TargetType="RadioButton">
            <Setter Property="Margin" Value="0,0,5,0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#DEE2E6"/>
            <Setter Property="Background" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Background" Value="#007BFF"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#007BFF"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0056b3"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#B0C4DE"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#212529"/>
            <Setter Property="BorderBrush" Value="#DEE2E6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F8F9FA"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Text="Добавление нового должника" 
                   Margin="20,15" 
                   FontSize="22" 
                   FontWeight="Bold"/>

        <!-- Main Content Area -->
        <ScrollViewer Grid.Row="1" Margin="20,0,20,0" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <TabControl Background="Transparent" BorderThickness="0,1,0,0" BorderBrush="#DEE2E6">
                    <!-- Личные данные -->
                    <TabItem Header="Личные данные">
                        <StackPanel Margin="0,15,0,0">
                            <!-- ФИО -->
                            <TextBlock Text="ФИО должника" Style="{StaticResource HeaderTextBlock}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Фамилия *" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding LastName, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="0,0,10,0">
                                    <TextBlock Text="Имя *" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding FirstName, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Отчество" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding MiddleName, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                            </Grid>
                            
                            <!-- Контактные данные -->
                            <TextBlock Text="Контактные данные" Style="{StaticResource HeaderTextBlock}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Телефон" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding Phone, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="E-mail" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                            </Grid>
                            
                            <!-- Паспортные данные -->
                            <TextBlock Text="Паспортные данные" Style="{StaticResource HeaderTextBlock}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="0.5*"/>
                                    <ColumnDefinition Width="0.5*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Серия" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding PassportSeries, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="0,0,10,0">
                                    <TextBlock Text="Номер" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding PassportNumber, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Дата выдачи" Style="{StaticResource FormTextBlock}"/>
                                    <DatePicker SelectedDate="{Binding PassportIssueDate}" Style="{StaticResource FormDatePicker}"/>
                                </StackPanel>
                            </Grid>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Кем выдан" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding PassportIssuedBy, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Код подразделения" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding PassportDivisionCode, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                            </Grid>
                            
                            <!-- Адреса -->
                            <TextBlock Text="Адреса" Style="{StaticResource HeaderTextBlock}"/>
                            
                            <TextBlock Text="Адрес регистрации *" Style="{StaticResource FormTextBlock}"/>
                            <TextBox Text="{Binding RegistrationAddress, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                            
                            <CheckBox Content="Адрес проживания совпадает с адресом регистрации" 
                                      IsChecked="{Binding SameAsRegistration}" 
                                      Style="{StaticResource FormCheckBox}"/>
                            
                            <TextBlock Text="Адрес проживания" Style="{StaticResource FormTextBlock}"
                                       IsEnabled="{Binding SameAsRegistration, Converter={StaticResource BooleanToInverseConverter}}"/>
                            <TextBox Text="{Binding ResidenceAddress, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource FormTextBox}"
                                     IsEnabled="{Binding SameAsRegistration, Converter={StaticResource BooleanToInverseConverter}}"/>
                            
                            <CheckBox Content="Почтовый адрес совпадает с адресом проживания" 
                                      IsChecked="{Binding SameAsResidence}" 
                                      Style="{StaticResource FormCheckBox}"/>
                            
                            <TextBlock Text="Почтовый адрес" Style="{StaticResource FormTextBlock}"
                                       IsEnabled="{Binding SameAsResidence, Converter={StaticResource BooleanToInverseConverter}}"/>
                            <TextBox Text="{Binding MailingAddress, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource FormTextBox}"
                                     IsEnabled="{Binding SameAsResidence, Converter={StaticResource BooleanToInverseConverter}}"/>
                        </StackPanel>
                    </TabItem>
                    
                    <!-- Договор -->
                    <TabItem Header="Договор">
                        <StackPanel Margin="0,15,0,0">
                            <!-- Основные данные договора -->
                            <TextBlock Text="Основные данные договора" Style="{StaticResource HeaderTextBlock}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Номер договора" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding ContractNumber, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="0,0,10,0">
                                    <TextBlock Text="Город" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding ContractCity, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Дата договора" Style="{StaticResource FormTextBlock}"/>
                                    <DatePicker SelectedDate="{Binding ContractDate}" Style="{StaticResource FormDatePicker}"/>
                                </StackPanel>
                            </Grid>
                            
                            <!-- Финансовые условия -->
                            <TextBlock Text="Финансовые условия" Style="{StaticResource HeaderTextBlock}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Общая стоимость договора (руб.)" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding TotalCost, StringFormat={}{0:N2}, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <Button Grid.Column="1" Content="Сумма прописью" 
                                        Command="{Binding CalculateTotalWordsCommand}"
                                        Style="{StaticResource SecondaryButton}"
                                        VerticalAlignment="Bottom" Margin="0,0,0,5"/>
                            </Grid>
                            
                            <TextBlock Text="Сумма прописью" Style="{StaticResource FormTextBlock}"/>
                            <TextBox Text="{Binding TotalCostWords, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource FormTextBox}" 
                                     TextWrapping="Wrap" 
                                     AcceptsReturn="True" 
                                     Height="60"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Сумма обязательных расходов (руб.)" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding MandatoryExpenses, StringFormat={}{0:N2}, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <Button Grid.Column="1" Content="Сумма прописью" 
                                        Command="{Binding CalculateMandatoryWordsCommand}"
                                        Style="{StaticResource SecondaryButton}"
                                        VerticalAlignment="Bottom" Margin="0,0,0,5"/>
                            </Grid>
                            
                            <TextBlock Text="Сумма прописью" Style="{StaticResource FormTextBlock}"/>
                            <TextBox Text="{Binding MandatoryExpensesWords, UpdateSourceTrigger=PropertyChanged}" 
                                     Style="{StaticResource FormTextBox}" 
                                     TextWrapping="Wrap" 
                                     AcceptsReturn="True" 
                                     Height="60"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Размер вознаграждения фин. управляющего (руб.)" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding ManagerFee, StringFormat={}{0:N2}, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Прочие расходы банкротства (руб.)" Style="{StaticResource FormTextBlock}"/>
                                    <TextBox Text="{Binding OtherExpenses, StringFormat={}{0:N2}, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </TabItem>
                    
                    <!-- Статус -->
                    <TabItem Header="Статус">
                        <StackPanel Margin="0,15,0,0">
                            <TextBlock Text="Статус в программе" Style="{StaticResource HeaderTextBlock}"/>
                            
                            <TextBlock Text="Текст кнопки статуса" Style="{StaticResource FormTextBlock}"/>
                            <TextBox Text="{Binding Status, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource FormTextBox}"/>
                            
                            <TextBlock Text="Основная категория" Style="{StaticResource HeaderTextBlock}"/>
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,10">
                                <RadioButton Content="Лиды" GroupName="MainCategory" IsChecked="{Binding MainCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Лиды}" Style="{StaticResource TabButton}"/>
                                <RadioButton Content="Клиенты" GroupName="MainCategory" IsChecked="{Binding MainCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Клиенты}" Style="{StaticResource TabButton}"/>
                                <RadioButton Content="Отказ" GroupName="MainCategory" IsChecked="{Binding MainCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Отказ}" Style="{StaticResource TabButton}"/>
                            </StackPanel>
                            
                            <TextBlock Text="Фильтр" Style="{StaticResource HeaderTextBlock}"/>
                            
                            <!-- Фильтры для Лиды -->
                            <StackPanel Visibility="{Binding MainCategory, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=Лиды}">
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,10">
                                    <RadioButton Content="Консультация не назначена" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Консультация не назначена}" Style="{StaticResource TabButton}"/>
                                    <RadioButton Content="Консультация назначена" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Консультация назначена}" Style="{StaticResource TabButton}"/>
                                    <RadioButton Content="Повторная консультация" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Повторная консультация}" Style="{StaticResource TabButton}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Фильтры для Клиенты -->
                            <StackPanel Visibility="{Binding MainCategory, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=Клиенты}">
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,10">
                                    <RadioButton Content="Сбор документов" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Сбор документов}" Style="{StaticResource TabButton}"/>
                                    <RadioButton Content="Подготовка заявления" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Подготовка заявления}" Style="{StaticResource TabButton}"/>
                                    <RadioButton Content="На рассмотрении" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=На рассмотрении}" Style="{StaticResource TabButton}"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <RadioButton Content="Ходатайство" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Ходатайство}" Style="{StaticResource TabButton}"/>
                                    <RadioButton Content="Заседание" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Заседание}" Style="{StaticResource TabButton}"/>
                                    <RadioButton Content="Процедура введена" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Процедура введена}" Style="{StaticResource TabButton}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Фильтры для Отказ -->
                            <StackPanel Visibility="{Binding MainCategory, Converter={StaticResource StringEqualsToVisibilityConverter}, ConverterParameter=Отказ}">
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,10">
                                    <RadioButton Content="Мой отказ" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Мой отказ}" Style="{StaticResource TabButton}"/>
                                    <RadioButton Content="Отказ должника" GroupName="FilterCategory" IsChecked="{Binding FilterCategory, Converter={StaticResource StringEqualsConverter}, ConverterParameter=Отказ должника}" Style="{StaticResource TabButton}"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </TabItem>
                </TabControl>
            </StackPanel>
        </ScrollViewer>

        <!-- Bottom action area -->
        <Grid Grid.Row="2" Background="White" Margin="20,15,20,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" Text="* Обязательные поля" VerticalAlignment="Center" Foreground="#6C757D"/>
            <Button Grid.Column="1" Content="Отмена" Width="100" Margin="0,0,10,0" Command="{Binding CancelCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}" Style="{StaticResource SecondaryButton}"/>
            <Button Grid.Column="2" Content="Сохранить" Width="120" Command="{Binding SaveCommand}" Style="{StaticResource PrimaryButton}"/>
        </Grid>
        
        <!-- Busy indicator -->
        <Grid Grid.RowSpan="3" Background="#80000000" Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="Сохранение данных..." Foreground="White" FontSize="16" Margin="0,0,0,10"/>
                <ProgressBar IsIndeterminate="True" Width="200" Height="10"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>